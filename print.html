<!DOCTYPE html>
<html>
  <head>
    <link
      rel="icon"
      type="image/png"
      href="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png"
    />
    <meta charset="UTF-8" />
    <title>Chek</title>

    <style>
      @media print {
        @page {
          size: 58mm auto;
          margin: 0;
        }
      }
      body {
        font-family: monospace;
        width: 58mm;
        margin: 0;
        padding: 6px;
        font-size: 11px;
      }
      .center {
        text-align: center;
      }
      .bold {
        font-weight: 700;
      }
      .line {
        border-top: 1px dashed #000;
        margin: 6px 0;
      }
      .small {
        font-size: 10px;
      }
      .right {
        text-align: right;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      td {
        padding: 2px 0;
      }
    </style>
  </head>

  <body>
    <div class="center">
      <img
        src="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png"
        width="120"
      /><br />
      <div class="bold">BRAND ФАБРИКА ЧИСТКИ</div>
      <div class="small">
        Ул. Буюк Ипак Йули 62А<br />
        Ташкент<br />
        Тел: 71 203 82 82
      </div>
    </div>

    <div class="line"></div>

    <!-- SANA + VAQT -->
    <div class="center bold" id="dt"></div>
    <div class="center bold" id="orderno"></div>

    <div id="cust"></div>

    <div class="line"></div>

    <table id="tbl">
      <tr class="bold">
        <td>Наим.</td>
        <td>Кол</td>
        <td class="right">Сумма</td>
      </tr>
    </table>

    <div class="line"></div>

    <div id="total"></div>
    <div>Оплачено: <span id="paid"></span></div>
    <div>Остаток: <span id="rest"></span></div>
    <div>Тип оплаты: <span id="ptype"></span></div>

    <div class="line"></div>

    <div>Дата выдачи: <span id="duedate"></span></div>

    <div class="line"></div>

    <div class="small">
      ВНИМАНИЕ ЗАКАЗЧИКА!<br />
      Химчистка не несет ответственности за скрытые дефекты изделия.
    </div>

    <div class="line"></div>
    <div class="small">Подпись клиента: ______________________</div>

    <script>
      const d = JSON.parse(localStorage.getItem("currentOrder") || "{}");

      // Sana
      document.getElementById("dt").textContent = d.date || "";

      // Chek raqami (agar yo‘q bo‘lsa yashiriladi)
      document.getElementById("orderno").textContent = d.order
        ? "Чек № " + d.order
        : "";

      // Xaridor
      document.getElementById("cust").innerHTML = `
        <div><b>Заказчик:</b> ${d.name ? d.name : "—"}</div>
        ${d.address ? `<div>${d.address}</div>` : ""}
        ${d.phone ? `<div>${d.phone}</div>` : ""}
      `;

      let S = 0;

      if (Array.isArray(d.items)) {
        d.items.forEach((i) => {
          S += Number(i.sum || 0);
          document.getElementById("tbl").innerHTML += `
            <tr>
              <td>КОВЕР</td>
              <td>${i.l}×${i.w}</td>
              <td class="right">${Number(i.sum).toLocaleString()}</td>
            </tr>
          `;
        });
      }

      document.getElementById("total").textContent =
        "ИТОГО: " + S.toLocaleString() + " сум";

      const paid = Number(d.paid || 0);
      document.getElementById("paid").textContent =
        paid.toLocaleString() + " сум";

      document.getElementById("rest").textContent =
        (S - paid).toLocaleString() + " сум";

      document.getElementById("ptype").textContent = d.paymentType || "—";

      document.getElementById("duedate").textContent = d.dueDate
        ? new Date(d.dueDate).toLocaleString()
        : "—";

      window.print();
      window.onafterprint = () => window.close();
    </script>
  </body>
</html>
