<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <title>Brand</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="icon"
      type="image/png"
      href="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png"
    />

    <style>
      :root {
        --bg: #020617;
        --card: #020617;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --accent: #38bdf8;
        --border: #1e293b;
        --success: #22c55e;
        --danger: #ef4444;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        background: radial-gradient(circle at top, #020617, #000);
        color: var(--text);
        font-family: system-ui, sans-serif;
      }

      .wrap {
        max-width: 1200px;
        margin: auto;
        padding: 16px;
      }

      h1 {
        text-align: center;
        margin-bottom: 16px;
      }

      /* BUTTONS */
      button {
        padding: 10px 14px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        background: var(--accent);
        color: #000;
        font-weight: 700;
        transition: 0.15s;
      }

      button.secondary {
        background: transparent;
        color: var(--text);
        border: 1px solid var(--border);
      }

      button:active {
        transform: scale(0.96);
      }

      /* TOP BAR */
      .top-bar {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      /* STATS */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
        margin-bottom: 16px;
      }

      .stat {
        background: rgba(2, 6, 23, 0.85);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 14px;
        text-align: center;
      }

      .stat b {
        display: block;
        font-size: 22px;
        margin-top: 6px;
      }

      /* LOADING */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        color: var(--muted);
        margin: 0px 0;
      }

      .spinner {
        width: 45px;
        height: 45px;
        border: 3px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* TABLE */
      .table-wrap {
        overflow-x: auto;
        background: rgba(2, 6, 23, 0.8);
        border: 1px solid var(--border);
        border-radius: 16px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 850px;
      }

      th,
      td {
        padding: 12px;
        border-bottom: 1px dashed var(--border);
        font-size: 14px;
        white-space: nowrap;
      }

      th {
        color: var(--muted);
        text-align: left;
      }

      .done {
        color: var(--success);
        font-weight: 700;
      }

      .action {
        min-width: 130px;
      }

      @media (max-width: 768px) {
        table {
          min-width: 720px;
        }
      }
      button.rotating {
        position: relative;
      }

      button.rotating::before {
        content: "üîÑ";
        display: inline-block;
        margin-right: 6px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      /* TOPBAR */
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        padding: 14px 18px;
        margin-bottom: 18px;

        background: rgba(2, 6, 23, 0.7);
        backdrop-filter: blur(12px);
        border: 1px solid var(--border);
        border-radius: 18px;
      }

      /* TITLE */
      .topbar .title {
        font-size: 22px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* ACTIONS */
      .topbar-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      /* BUTTON BASE */
      .btn {
        border-radius: 12px;
        padding: 10px 16px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      /* PRIMARY */
      .btn.primary {
        background: linear-gradient(135deg, #38bdf8, #0ea5e9);
        color: #000;
      }

      /* SECONDARY */
      .btn.secondary {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }

      /* GHOST */
      .btn.ghost {
        background: rgba(56, 189, 248, 0.12);
        color: var(--accent);
        border: 1px dashed var(--border);
      }

      /* BACK */
      .btn.back {
        background: rgba(34, 197, 94, 0.15);
        color: #22c55e;
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      /* ACTIVE */
      .btn.active {
        box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.4);
        transform: translateY(-1px);
      }

      /* HOVER */
      .btn:hover {
        transform: translateY(-1px);
        opacity: 0.95;
      }

      .btn:active {
        transform: scale(0.96);
      }

      /* MOBILE */
      @media (max-width: 768px) {
        .topbar {
          flex-direction: column;
          align-items: stretch;
        }

        .topbar-actions {
          justify-content: space-between;
        }

        .btn {
          flex: 1;
          text-align: center;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <!-- TOP -->
      <div class="topbar">
        <div class="topbar-left">
          <span class="title"> üìä <b>Hisobotlar</b> </span>
        </div>

        <div class="topbar-actions">
          <button id="refreshBtn" onclick="refreshOrders()" class="btn ghost">
            Yangilash
          </button>

          <button
            onclick="setMode('today')"
            class="btn primary active"
            id="btnToday"
          >
            üìÖ Bugun
          </button>

          <button onclick="setMode('all')" class="btn secondary" id="btnAll">
            üìÜ Barchasi
          </button>

          <button onclick="goIndex()" class="btn back">‚Üê Yangi buyurtma</button>
        </div>
      </div>

      <!-- STATS -->
      <div class="stats">
        <div class="stat">üë• Bugungi mijozlar<b id="sClients">0</b></div>
        <div class="stat">üöö Yetkazildi<b id="sDelivered">0</b></div>
        <div class="stat">üí∞ Bugungi tushum<b id="sProfit">0</b></div>
      </div>

      <!-- LOADING -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
      </div>

      <!-- TABLE -->
      <div class="table-wrap" id="tableWrap" style="display: none">
        <table>
          <thead>
            <tr>
              <th>Ism</th>
              <th>Telefon</th>
              <th>Sana</th>
              <th>Jami</th>
              <th>To‚Äòlangan</th>
              <th>Holat</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>

    <script>
      const API = "https://gilam-yuvish-backend.onrender.com";
      let orders = [];
      let mode = "today";

      function goIndex() {
        location.href = "index.html";
      }

      function isToday(dateStr) {
        const d = new Date(dateStr);
        const now = new Date();
        return d.toDateString() === now.toDateString();
      }

      function setMode(m) {
        mode = m;
        render();
      }

      async function loadOrders() {
        loading.style.display = "flex";
        tableWrap.style.display = "none";

        const r = await fetch(API + "/orders");
        orders = await r.json();

        setTimeout(() => {
          loading.style.display = "none";
          tableWrap.style.display = "block";
          render();
        }, 300);
      }

      function render() {
        tbody.innerHTML = "";

        const list =
          mode === "today"
            ? orders.filter((o) => isToday(o.createdAt))
            : orders;

        sClients.textContent = list.length;
        sDelivered.textContent = list.filter((o) => o.delivered).length;

        // üí∞ FOYDA = TUSHGAN PUL
        sProfit.textContent = list
          .reduce((s, o) => s + Number(o.paid || 0), 0)
          .toLocaleString();

        list
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .forEach((o) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${o.name || "‚Äî"}</td>
              <td>${o.phone || "‚Äî"}</td>
              <td>${new Date(o.createdAt).toLocaleString()}</td>
              <td>${Number(o.total).toLocaleString()}</td>
              <td>${Number(o.paid || 0).toLocaleString()}</td>
              <td class="${o.delivered ? "done" : ""}">
                ${o.delivered ? "Yetkazildi" : "Kutilmoqda"}
              </td>
              <td class="action">
                ${
                  o.delivered
                    ? ""
                    : `<button onclick="deliver('${o._id}')">üöö Yetkazildi</button>`
                }
              </td>
            `;
            tbody.appendChild(tr);
          });
      }

      async function deliver(id) {
        await fetch(API + "/orders/" + id + "/deliver", { method: "PUT" });
        loadOrders();
      }

      loadOrders();
      async function refreshOrders() {
        const btn = document.getElementById("refreshBtn");

        btn.classList.add("rotating");

        try {
          await loadOrders(); // mavjud funksiya (ordersni qayta yuklaydi)
        } catch (e) {
          alert("Yangilashda xatolik");
        } finally {
          btn.classList.remove("rotating");
        }
      }
      function setMode(m) {
        mode = m;

        document.getElementById("btnToday").classList.remove("active");
        document.getElementById("btnAll").classList.remove("active");

        if (m === "today") {
          document.getElementById("btnToday").classList.add("active");
        } else {
          document.getElementById("btnAll").classList.add("active");
        }

        render();
      }
    </script>
  </body>
</html>
