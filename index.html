<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <title>Gilam Yuvish â€” Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --bg: #0f172a;
        --sidebar: #020617;
        --card: #020617;
        --panel: #020617;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --accent: #38bdf8;
        --danger: #ef4444;
        --border: #1e293b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, sans-serif;
      }

      .app {
        display: flex;
        min-height: 100vh;
      }

      /* SIDEBAR */
      .sidebar {
        width: 260px;
        background: var(--sidebar);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .logo {
        font-size: 20px;
        font-weight: 800;
        text-align: center;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border);
      }

      .menu button {
        width: 100%;
        padding: 14px;
        border-radius: 12px;
        border: none;
        background: transparent;
        color: var(--text);
        text-align: left;
        font-size: 15px;
        cursor: pointer;
      }

      .menu button:hover {
        background: #020617;
      }

      /* MAIN */
      .main {
        flex: 1;
        padding: 24px;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
      }

      .card {
        background: var(--card);
        border-radius: 18px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      }

      h2 {
        margin-top: 0;
      }

      input,
      button {
        width: 100%;
        padding: 14px;
        border-radius: 12px;
        font-size: 15px;
        margin-top: 10px;
      }

      input {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }

      button {
        border: none;
        background: var(--accent);
        color: #020617;
        font-weight: 700;
        cursor: pointer;
      }

      button:active {
        transform: scale(0.97);
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 10px 0;
      }

      li {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed var(--border);
      }

      .total {
        text-align: center;
        font-size: 20px;
        font-weight: 800;
        margin: 12px 0;
      }

      /* HISTORY */
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      th,
      td {
        padding: 10px;
        border-bottom: 1px solid var(--border);
        text-align: left;
      }

      th {
        color: var(--muted);
      }

      .actions button {
        width: auto;
        padding: 6px 10px;
        font-size: 13px;
        margin-right: 6px;
      }

      .delete {
        background: var(--danger);
        color: white;
      }

      .open {
        background: #22c55e;
        color: #020617;
      }

      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .sidebar {
          display: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="logo">ðŸ§º GILAM ADMIN</div>
        <div class="menu">
          <button>âž• Yangi buyurtma</button>
          <button>ðŸ§¾ Cheklar tarixi</button>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="main">
        <div class="grid">
          <!-- CREATE ORDER -->
          <div class="card">
            <h2>âž• Yangi buyurtma</h2>

            <input id="name" placeholder="Ism" />
            <input id="phone" placeholder="Telefon" />

            <input id="price" type="number" value="10000" />

            <input id="l" type="number" placeholder="Uzunlik" />
            <input id="w" type="number" placeholder="Eni" />
            <button onclick="addItem()">Gilam qoâ€˜shish</button>

            <ul id="list"></ul>

            <div class="total">Jami: <span id="total">0</span> soâ€˜m</div>

            <input id="paid" type="number" placeholder="Toâ€˜langan summa" />

            <button onclick="saveOrder()">ðŸ§¾ Chek chiqarish</button>
          </div>

          <!-- HISTORY -->
          <div class="card">
            <h2>ðŸ§¾ Cheklar tarixi</h2>

            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ism</th>
                  <th>Jami</th>
                  <th>Amallar</th>
                </tr>
              </thead>
              <tbody id="history"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <script>
      const API = "https://gilam-yuvish-backend.onrender.com";

      let items = [];
      const list = document.getElementById("list");
      const totalEl = document.getElementById("total");
      const historyEl = document.getElementById("history");

      function addItem() {
        const l = +document.getElementById("l").value;
        const w = +document.getElementById("w").value;
        const p = +document.getElementById("price").value;

        if (!l || !w) return alert("Oâ€˜lcham kiriting");

        items.push({ l, w, sum: l * w * p });
        l.value = w.value = "";
        render();
      }

      function render() {
        list.innerHTML = "";
        let sum = 0;
        items.forEach((i) => {
          sum += i.sum;
          list.innerHTML += `
      <li><span>${i.l}Ã—${i.w}</span><span>${i.sum.toLocaleString()}</span></li>
    `;
        });
        totalEl.textContent = sum.toLocaleString();
      }

      async function saveOrder() {
        if (!name.value) return alert("Ism kiriting");
        if (!items.length) return alert("Gilam yoâ€˜q");

        const order = {
          name: name.value,
          phone: phone.value,
          items,
          total: items.reduce((s, i) => s + i.sum, 0),
          paid: +paid.value || 0,
        };

        const res = await fetch(API + "/orders", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order),
        });

        const saved = await res.json();
        localStorage.setItem("currentOrder", JSON.stringify(saved));

        items = [];
        list.innerHTML = "";
        totalEl.textContent = "0";
        name.value = phone.value = paid.value = "";

        window.open("print.html", "_blank");
        loadHistory();
      }

      async function loadHistory() {
        const res = await fetch(API + "/orders");
        const orders = await res.json();

        historyEl.innerHTML = "";
        orders.reverse().forEach((o) => {
          historyEl.innerHTML += `
      <tr>
        <td>${o.orderNo || "-"}</td>
        <td>${o.name}</td>
        <td>${Number(o.total).toLocaleString()}</td>
        <td class="actions">
          <button class="open" onclick='openCheck(${JSON.stringify(
            o
          )})'>Ochish</button>
          <button class="delete" onclick="deleteOrder('${
            o._id
          }')">Oâ€˜chirish</button>
        </td>
      </tr>
    `;
        });
      }

      function openCheck(order) {
        localStorage.setItem("currentOrder", JSON.stringify(order));
        window.open("print.html", "_blank");
      }

      async function deleteOrder(id) {
        if (!confirm("Rostdan oâ€˜chirasizmi?")) return;
        await fetch(API + "/orders/" + id, { method: "DELETE" });
        loadHistory();
      }

      loadHistory();
    </script>
  </body>
</html>
