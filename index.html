<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <title>Gilam Yuvish</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        margin: 0;
        background: #f1f5f9;
        font-family: system-ui, sans-serif;
      }
      .wrap {
        max-width: 900px;
        margin: auto;
        padding: 24px;
      }
      .card {
        background: #fff;
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        margin-bottom: 16px;
      }
      h1 {
        text-align: center;
      }
      input,
      button {
        width: 100%;
        padding: 14px;
        margin-top: 10px;
        border-radius: 12px;
        font-size: 16px;
      }
      input {
        border: 1px solid #e5e7eb;
      }
      button {
        border: none;
        background: #2563eb;
        color: #fff;
        cursor: pointer;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px dashed #ddd;
        padding: 8px 0;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="card">
        <button onclick="openReport()">ðŸ“Š Hisobot</button>
      </div>

      <div class="card">
        <h1>ðŸ§º Gilam Yuvish</h1>

        <input id="name" placeholder="Ism" />
        <input id="phone" placeholder="Telefon" />

        <input id="price" type="number" value="10000" />

        <input id="l" type="number" placeholder="Uzunlik" />
        <input id="w" type="number" placeholder="Eni" />
        <button onclick="add()">âž• Qoâ€˜shish</button>

        <ul id="list"></ul>

        <b>Jami: <span id="total">0</span> soâ€˜m</b>

        <input id="paid" type="number" placeholder="Toâ€˜langan summa" />

        <button onclick="save()">ðŸ§¾ Chek chiqarish</button>
      </div>
    </div>

    <script>
      const API = "https://gilam-yuvish-backend.onrender.com";
      let items = [];

      function openReport() {
        window.open("hisobot.html", "_blank");
      }

      function add() {
        const L = +l.value;
        const W = +w.value;
        const P = +price.value;

        if (!L || !W) return alert("Oâ€˜lcham kiriting");

        items.push({ l: L, w: W, sum: L * W * P });
        l.value = w.value = "";
        render();
      }

      function render() {
        list.innerHTML = "";
        let s = 0;
        items.forEach((i) => {
          s += i.sum;
          list.innerHTML += `<li><span>${i.l}Ã—${
            i.w
          }</span><span>${i.sum.toLocaleString()}</span></li>`;
        });
        total.textContent = s.toLocaleString();
      }

      function save() {
        if (!items.length) return alert("Gilam qoâ€˜shing");
        if (!name.value) return alert("Ism kiriting");

        const totalSum = items.reduce((s, i) => s + i.sum, 0);

        const order = {
          name: name.value,
          phone: phone.value,
          items: items,
          total: totalSum,
          paid: Number(paid.value) || 0,
        };

        localStorage.setItem("currentOrder", JSON.stringify(order));

        fetch(`${API}/orders`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order),
        })
          .then((r) => r.json())
          .then(() => {
            items = [];
            render();
            name.value = phone.value = paid.value = "";
            window.open("print.html", "_blank");
          })
          .catch(() => alert("Server xatosi"));
      }
    </script>
  </body>
</html>
